<html>
<head>
<script src="http://maps.google.com/maps/api/js?sensor=true" type="text/javascript"></script>
<script src="js/markerclusterer_compiled.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" media="all" href="css/style.css" />
<title>El cumple Nº5 de Camilo!</title>
</head>
<body>
<div id="map_canvas"></div>

<script type="text/javascript">
  var map;

  function initialize() {
    var myOptions = {
      zoom: 16,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    map = new google.maps.Map(document.getElementById('map_canvas'),myOptions);

    if(navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var pos = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
        var infowindow = new google.maps.InfoWindow({map: map, position: pos, content: 'Estás aquí' });
        map.setCenter(pos);
        calculateRoute(pos, 'Calle los Cerezos 4240, Peñalolén, Santiago');
      }, function() {
        handleError(true);
      });
    } else {
      // Si el navegador no soporta geolocalización
      handleError(false);
    }
  }
  
  function handleError(errorFlag) {

    if (errorFlag) {
      var content = 'Error en el servicio de geolocalizacion.';
    } else {
      var content = 'Error: Tu navegador no soporta geolocalización.';
    }

    var options = { map: map, position: new google.maps.LatLng(60, 105), content: content };
    var infowindow = new google.maps.InfoWindow(options);
    map.setCenter(options.position);

  }

  function calculateRoute(from, to){

    var directionsService = new google.maps.DirectionsService();
    var directionsRequest = {
      origin: from,
      destination: to,
      travelMode: google.maps.DirectionsTravelMode.DRIVING,
      unitSystem: google.maps.UnitSystem.METRIC
    };
    directionsService.route(
      directionsRequest,
      function(response, status)
      {
        if (status == google.maps.DirectionsStatus.OK)
        {
          new google.maps.DirectionsRenderer({
            map: map,
            directions: response
          });
        }
        else
          $("#error").append("Unable to retrieve your route<br />");
      }
    );
  }


  google.maps.event.addDomListener(window, 'load', initialize);
</script>
</body>
</html>